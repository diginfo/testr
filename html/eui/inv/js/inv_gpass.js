dwap.page.loadData=function(e){$("#gplines").datagrid("load",{_func:"get",_sqlid:"inv^gplines",_dgrid:"y",GP_ID:e.GP_ID}),$("#GP_TYPE").textbox("readonly"),$("#GP_TYPE_ID").textbox("readonly"),$("#GP_DATE").datebox("readonly"),$("#TX_TYPE").combobox("readonly"),butEn("adx"),$("#gplines").datagrid("options").tbar.dgre_add.linkbutton("enable");var t={C:"SO",V:"WO"}[$("#GP_TYPE").combobox("getValue")],o=[{value:t,text:t},{value:"NIL",text:"NIL"}],i=$("#_dgform > form input[textboxname=DOC_TYPE"),a=$("#_dgform > form input[textboxname=DOC_ID");a.textbox("readonly",!0),i.combobox("loadData",o),i.combobox({onSelect:function(e){"NIL"==e.value?(a.textbox("readonly"),a.textbox("required",!1)):(a.textbox("readonly",!1),a.textbox("required",!0),"SO"==e.value?(a.qbe("options").queryParams._sqlid="sales^sor_qbe",a.qbe("options").queryParams.CUST_ID=$("#GP_TYPE_ID").combobox("getValue")):(a.qbe("options").queryParams._sqlid="inv^gp_opnrefs_qbe",a.qbe("options").queryParams.CUST_ID&&delete a.qbe("options").queryParams.CUST_ID),a.qbe("options").dlog.dg.datagrid("reload"))}})},dwap.page.opts={twoColumns:!0,editor:"form",rownumbers:!1,fitColumns:!0,fit:!0,url:"/",queryParams:{_sqlid:"inv^gplines",_func:"get",_dgrid:"y"},addData:{LINE_NO:"$autonum:1",GP_ID:"#GP_ID"},columns:[[{field:"GP_ID",hidden:!0},{field:"LINE_NO",title:"#",width:40,fixed:!0,align:"center"},{field:"DOC_TYPE",title:"Doc Type",width:70,fixed:!0,editor:{type:"combobox",options:{panelHeight:"auto",editable:!1,required:!0}}},{field:"DOC_ID",title:"Doc ID",width:120,fixed:!0,editor:{type:"qbe",options:{queryParams:{_sqlid:""},readonly:!0,onDemand:!0,multiCol:!0,fields:[{field:"value",title:"Doc ID",width:80,fixed:!0},{field:"STATUS",title:"Status",editor:{type:"combobox",options:{panelHeight:"auto",editable:!1,data:[{value:"H",text:"On Hold"},{value:"R",text:"Released",selected:!0},{value:"C",text:"Closed"}]}}},{field:"QTY",title:"Qty",width:50,fixed:!0},{field:"GATEPASS_QTY",title:"Gatepass Qty",width:50,fixed:!0},{field:"PART_ID",title:"Part ID",width:100,fixed:!0},{field:"PART_DESCRIPTION",title:"Part Desc",width:150,fixed:!0},{field:"CUST_PART_ID",title:"Cust Part Ref",width:100,fixed:!0},{field:"USER_1",title:"Cust Prod Order #",width:150,fixed:!0}],onSelect:function(e){switch($("#_dgform > form input[textboxname=PART_ID").textbox("setValue",e.PART_ID),$("#_dgform > form input[textboxname=PART_DESCRIPTION").textbox("setValue",e.PART_DESCRIPTION),$("#_dgform > form input[textboxname=DOC_TYPE").combobox("getValue")){case"SO":var t=$("#TX_TYPE").combobox("getValue"),o=e.text;if("S"==t)var i=e.QTY-e.GATEPASS_QTY;else i=e.GATEPASS_QTY;$("#_dgform > form input[textboxname=DOC_ID").textbox("setValue",o),$("#_dgform > form input[textboxname=QTY").numberspinner("set",{min:0,max:i}),$("#_dgform > form input[textboxname=BAL_QTY").numberbox("setValue",i),$("#_dgform > form input[textboxname=BAL_QTY").numberbox("setValue",i),$("#_dgform > form input[textboxname=CUST_PROD_ORDER_NO").textbox("setValue",e.USER_1),$("#_dgform > form input[textboxname=CUST_PART_ID").textbox("setValue",e.CUST_PART_ID);break;case"WO":var a=(o=e.text).split("^"),d=a.join(".");ajaxget("/",{_func:"get",_sqlid:"vwltsa^sub",WOREF:a[0]+"^"+a[1]},function(e){if("S"==$("#TX_TYPE").combobox("getValue"))var t=e.DESIRED_QTY-e.GATEPASS_QTY;else t=e.GATEPASS_QTY;$("#_dgform > form input[textboxname=DOC_ID").textbox("setValue",d),$("#_dgform > form input[textboxname=QTY").numberspinner("set",{min:0,max:t}),$("#_dgform > form input[textboxname=BAL_QTY").numberbox("setValue",t)})}}}}},{field:"PART_ID",title:"Our Part ID",width:160,fixed:!0,editor:{type:"qbe",options:{queryParams:{_sqlid:"inv^partid_qbe"},onDemand:!0,multiCol:!0,valueField:"ID",fields:[{field:"value",title:"Part ID",editor:"textbox"},{field:"DESCRIPTION",title:"Description",editor:"textbox",formatter:function(e){return e?e.substring(0,50):""}},{field:"UOM_ID",title:"UOM"},{field:"ALIAS_DESC",title:"Alias",editor:"textbox"},{field:"TRACEABLE",title:"Traceable",editor:{type:"combobox",options:{panelHeight:"auto",data:[{value:"",text:"All",selected:!0},{value:"Y",text:"Yes"},{value:"N",text:"No"}]}}},{field:"DIM_TRACKED",title:"Dimensions",editor:{type:"combobox",options:{panelHeight:"auto",data:[{value:"",text:"All",selected:!0},{value:"Y",text:"Yes"},{value:"N",text:"No"}]}}},{field:"PART_CLASS_ID",title:"Part Class",editor:{type:"combobox",options:{panelHeight:"auto",data:[{value:"",text:"All",selected:!0},{value:"FG",text:"Finished Goods"},{value:"COMP",text:"Component"},{value:"CONSUMABLE",text:"Consumable"},{value:"MAKE_STAGED",text:"Make Staged"},{value:"MAKE_NOSTAGE",text:"Make Unstaged"}]}}},{field:"USER_1",title:"UDF 1",editor:"textbox"},{field:"USER_2",title:"UDF 2",editor:"textbox"},{field:"USER_3",title:"UDF 3",editor:"textbox"},{field:"USER_4",title:"UDF 4",editor:"textbox"},{field:"USER_5",title:"UDF 5",editor:"textbox"}],onSelect:function(e){$("#_dgform > form input[textboxname=PART_DESCRIPTION").textbox("setValue",e.DESCRIPTION),$("#_dgform > form input[textboxname=PART_UOM").textbox("setValue",e.UOM_ID)}}}},{field:"PART_UOM",title:"Part UOM",width:30,editor:{type:"textbox",options:{readonly:!0}},coloff:!0},{field:"CUST_PART_ID",title:"Cust Part Ref",width:100,editor:"text",coloff:!0},{field:"CUST_PROD_ORDER_NO",title:"Cust Prod Order #",width:100,editor:"text",coloff:!0},{field:"QTY",title:"Qty Reqd",width:60,fixed:!0,align:"center",editor:{type:"numberspinner",options:{precision:2,min:0,required:!0}}},{field:"BAL_QTY",title:"Bal Qty",width:60,fixed:!0,align:"center",editor:{type:"numberbox",options:{precision:2,readonly:!0}}},{field:"PART_DESCRIPTION",title:"Our Part Description",width:250,fixed:!0,editor:{type:"textbox",options:{readonly:!1,multiline:!0,height:150}},coloff:!0}]],onRowContextMenu:function(e){return e.preventDefault()},onBeforeLoad:function(e){if(!e.GP_ID)return!1},loadFilter:function(e){return e&&(e.rows||0!=e.length)||(e={rows:[],total:0}),e},onEndEdit:function(e,t,o){var i=clone(t);ajaxget("/?_sqlid=inv^gpline",i,function(e){})},onSelect:function(e,t){t.DOC_ID&&$(this).datagrid("options").tbar.dgre_edit.linkbutton("disable")}},$("#GP_ID").qbe({defid:"gatepass_ids"}),$("#GP_TYPE").combobox({editable:!1,panelHeight:"auto",data:[{text:"CUSTOMER",value:"C"},{text:"VENDOR",value:"V"}],onSelect:function(e){var t=$("#GP_TYPE_ID");t.combobox("clear"),t.combobox("options").queryParams._sqlid={C:"sales^custid",V:"inv^vendorid"}[e.value],t.combobox("reload")}}),$("#GP_TYPE_ID").combobox({url:"/",editable:!1,panelHeight:200,queryParams:{_sqlid:"",_func:"get",_combo:"y"},onBeforeLoad:function(e){if(!e._sqlid)return!1},onSelect:function(e){var t=$(this).combobox("options").queryParams._sqlid.replace(/id$/,"all");ajaxget("/",{_sqlid:t,_func:"get",ID:e.value},function(e){for(var t in e)$("input[textboxname="+t+"]").textbox("setValue",e[t])})}}),$("#gplines").datagrid("rowEditor",dwap.page.opts).datagrid("columns",$("#dgre_tb")),$("#gplines").datagrid("options").tbar.dgre_add.linkbutton("disable"),$("#gplines").datagrid("options").tbar.dgre_edit.linkbutton("disable"),$("#but_add").on("done",function(){$("#gplines").datagrid("loadData",{total:0,rows:[]}),$("#GP_TYPE").textbox("readonly",!1),$("#GP_TYPE_ID").textbox("readonly",!1),$("#GP_DATE").datebox("readonly",!1),$("#TX_TYPE").combobox("readonly",!1);var e=$("#GP_ID");e.textbox("required",!1),e.textbox("readonly",!0),butEn("x"),$("#gplines").datagrid("options").tbar.dgre_add.linkbutton("disable")}),$("#but_del").on("done",function(){$("#gplines").datagrid("loadData",{total:0,rows:[]}),$("#gplines").datagrid("options").tbar.dgre_add.linkbutton("disable")}),$("form#gphead").on("loadDone",function(e,t){t.GP_ID&&dwap.page.loadData(t)}).on("changed",function(e,t){$(this).form("options").loading||butEn("sadx")}).on("success",function(e){$("#gplines").datagrid("options").tbar.dgre_add.linkbutton("enable")}).on("done",function(e){e||(e={GP_ID:$("#GP_ID").texbox("getValue")}),dwap.page.loadData(e)});