dwap.page.opts={editor:"form",addData:{LINE_NO:"$autonum:1",PHYSICAL_COUNT_ID:"#PHYSICAL_COUNT_ID"},striped:!0,url:"/",queryParams:{_sqlid:"inv^physical_count_lines",_func:"get",_dgrid:"y"},rownumbers:!1,fitColumns:!1,fit:!0,pagePosition:"bottom",pagination:!0,pageList:[25,50,100,250],pageSize:25,columns:[[{field:"PHYSICAL_COUNT_ID",hidden:!0},{field:"LINE_NO",title:"#",width:30,fixed:!0,align:"center"},{field:"PART_ID",title:"Our Part ID",width:100,editor:{type:"qbe",options:{required:!0,queryParams:{_sqlid:"inv^physical_count_parts",_qbe:"y"},onDemand:!0,multiCol:!0,valueField:"PART_ID",fields:[{field:"value",title:"Part ID",editor:"textbox"},{field:"DESCRIPTION",title:"Description",editor:"textbox",formatter:function(e){return e?e.substring(0,50):""}},{field:"ALIAS_DESC",title:"Alias"},{field:"TRACE_ID",title:"Trace ID"},{field:"LENGTH",title:"Length"},{field:"WIDTH",title:"Width"},{field:"HEIGHT",title:"Height"},{field:"TRACEABLE",title:"Traceable",editor:{type:"combobox",options:{panelHeight:"auto",data:[{value:"",text:"All",selected:!0},{value:"Y",text:"Yes"},{value:"N",text:"No"}]}}},{field:"DIM_TRACKED",title:"Dimensions",editor:{type:"combobox",options:{panelHeight:"auto",data:[{value:"",text:"All",selected:!0},{value:"Y",text:"Yes"},{value:"N",text:"No"}]}}},{field:"PART_CLASS_ID",title:"Part Class",editor:{type:"combobox",options:{panelHeight:"auto",data:[{value:"",text:"All",selected:!0},{value:"FG",text:"Finished Goods"},{value:"COMP",text:"Component"},{value:"CONSUMABLE",text:"Consumable"},{value:"MAKE_STAGED",text:"Make Staged"},{value:"MAKE_NOSTAGE",text:"Make Unstaged"}]}}},{field:"PART_LENGTH",title:"Length Enabled"},{field:"PART_WIDTH",title:"Width Enabled"},{field:"PART_HEIGHT",title:"Height Enabled"}],onSelect:function(e){if("Y"==e.TRACEABLE)var t=!0;else t=!1;var i=$("#_dgform > form input[textboxname=TRACE_ID");if(i.textbox("required",t),i.textbox("readonly",!t),"Y"==e.DIM_TRACKED)t=!0;else t=!1;["LENGTH","WIDTH","HEIGHT"].map(function(i){t="N"!=e["PART_"+i];var n=$("#_dgform > form input[textboxname="+i);n.textbox("required",t),n.textbox("readonly",!t)})}}}},{field:"DESCRIPTION",title:"Description",width:100,fixed:!0,align:"left"},{field:"UOM_ID",title:"UOM",width:30,fixed:!0,align:"left"},{field:"TRACE_ID",title:"Trace ID",width:100,fixed:!0,align:"left",editor:{type:"textbox",options:{readonly:!0}}},{field:"LENGTH",title:"Length",width:100,fixed:!0,align:"right",editor:{type:"numberspinner",options:{precision:2,min:0,value:0,id:"length",readonly:!0}}},{field:"WIDTH",title:"Width",width:100,fixed:!0,align:"right",editor:{type:"numberspinner",options:{precision:2,min:0,value:0,id:"width",readonly:!0}}},{field:"HEIGHT",title:"Height",width:100,fixed:!0,align:"right",editor:{type:"numberspinner",options:{precision:2,min:0,value:0,id:"height",readonly:!0}}},{field:"COUNT",title:"Count Qty",width:100,fixed:!0,align:"right",editor:{type:"numberspinner",options:{precision:2,min:0,value:0,id:"count",readonly:!0}}},{field:"RECOUNT",title:"RECount Qty",width:100,fixed:!0,align:"right",editor:{type:"numberspinner",options:{precision:2,min:0,value:0,id:"recount",readonly:!0}}},{field:"NOTES",title:"Notes",width:250,fixed:!0,editor:{type:"textbox",options:{readonly:!1,multiline:!0,height:150}}}]],onRowContextMenu:function(e){return e.preventDefault()},onBeforeLoad:function(e){},loadFilter:function(e){return e.rows||(e={total:e.length,rows:e}),e},onEndEdit:function(e,t,i){var n=clone(t);void 0==n.PHYSICAL_COUNT_ID||ajaxget("/?_sqlid=inv^physical_count_line",n,function(e){})},onSelect:function(e,t){if(t){var i="enable";void 0==t.PHYSICAL_COUNT_ID&&(i="disable"),i=""==$("#END_COUNT_USER").textbox("getValue")?"enable":"disable",$(this).datagrid("options").tbar.dgre_edit.linkbutton(i),$(this).datagrid("options").tbar.dgre_edit.linkbutton(i),$(this).datagrid("options").tbar.dgre_del.linkbutton(i),dwap.page.count(t),"enable"==i&&(""==t.COUNT?$(this).datagrid("options").tbar.dgre_del.linkbutton("enable"):$(this).datagrid("options").tbar.dgre_del.linkbutton("disable"))}}},dwap.page.saverows=function(e){var t={_sqlid:"inv^physical_count_lines",_func:"add",PHYSICAL_COUNT_ID:e,TRACEABLE:$("#TRACEABLE").combobox("getValue"),PART_CLASS_ID:$("#PART_CLASS_ID").combobox("getValue"),DIM_TRACKED:$("#DIM_TRACKED").combobox("getValue"),PART_ID:$("#PART_ID").textbox("getValue"),INVENTORY_LOCK:$("#INVENTORY_LOCK").combobox("getValue"),CYCLE_COUNT:$("#CYCLE_COUNT").combobox("getValue"),PRODUCT_CODE:$("#PRODUCT_CODE").combobox("getValue")};ajaxget("/",t,function(e){})},dwap.page.lines=function(e){var t=$("#lines");t.datagrid("options").queryParams._sqlid=e._sqlid,t.datagrid("load",e)},dwap.page.count=function(e){var t=$("#_dgform > form input[textboxname=COUNT"),i=$("#_dgform > form input[textboxname=RECOUNT"),n=!0;e.PART_ID?(n=""==e.COUNT,t.numberspinner("readonly",!n),i.numberspinner("readonly",n)):(t.numberspinner("readonly",!0),i.numberspinner("readonly",!0))},dwap.page.recount=function(){var e={_sqlid:"inv^physical_count_lines_recount",_func:"get",_dgrid:"y"},t="inv^physical_count_lines_recount";switch(recount){case 0:t="inv^physical_count_lines",recount=1;break;case 1:t="inv^physical_count_lines_recount",recount=0;break;default:t="inv^physical_count_lines_recount",recount=0}e._sqlid=t,e.PHYSICAL_COUNT_ID=$("#PHYSICAL_COUNT_ID").combobox("getValue"),dwap.page.lines(e)},dwap.page.qbe=function(){var e,t=$("#PHYSICAL_COUNT_ID").combobox("getValue");""==t?((e={_sqlid:"inv^physical_count_parts",_func:"get"}).PART_CLASS_ID=$("#PART_CLASS_ID").combobox("getValue"),e.TRACEABLE=$("#TRACEABLE").combobox("getValue"),e.DIM_TRACKED=$("#DIM_TRACKED").combobox("getValue"),e.PART_ID=$("#PART_ID").textbox("getValue"),e.CYCLE_COUNT=$("#CYCLE_COUNT").combobox("getValue"),e.PRODUCT_CODE=$("#PRODUCT_CODE").combobox("getValue")):(e={_sqlid:"inv^physical_count_lines",_func:"get"}).PHYSICAL_COUNT_ID=t;dwap.page.lines(e)},dwap.page.endis=function(e){$("#but_save").linkbutton(e),$("#but_del").linkbutton(e),$("#endcount").linkbutton(e),$("#START_DATE").datebox(e),$("#END_DATE").datebox(e),$("#pwd").textbox(e),$("#NOTES").textbox(e),$("#lines").datagrid("options").tbar.dgre_add.linkbutton(e),$("#lines").datagrid("options").tbar.dgre_edit.linkbutton(e),$("#lines").datagrid("options").tbar.dgre_del.linkbutton(e)},dwap.page.endis_qbe=function(e){$("#START_DATE").datebox(e),$("#TRACEABLE,#DIM_TRACKED,#PART_CLASS_ID,#INVENTORY_LOCK,#CYCLE_COUNT,#PRODUCT_CODE").combobox(e),$("#PART_ID").textbox(e)},$(document).ready(function(){toolbut([{id:"recount",iconCls:"icon-calc",text:"RECount",disabled:!0,noText:!1,onClick:function(){dwap.page.recount()}}]),$("#lines").datagrid("rowEditor",dwap.page.opts),$("#but_add").on("done",function(){$("#endcount").linkbutton("disable"),$("#recount").linkbutton("disable"),dwap.page.endis("disable"),dwap.page.endis_qbe("enable"),$("#INVENTORY_LOCK,#CYCLE_COUNT").combobox("required",!0),butEn("sdx"),$("#lines").datagrid("loadData",{total:0,rows:[]})}),$("form#physical_count").on("loadDone",function(e,t){if(t.PHYSICAL_COUNT_ID){var i={_func:"get",_sqlid:"inv^physical_count_lines",_dgrid:"y",PHYSICAL_COUNT_ID:t.PHYSICAL_COUNT_ID};dwap.page.lines(i);var n="enable";t.END_COUNT_USER.length>0&&(n="disable"),dwap.page.endis(n),dwap.page.endis_qbe("disable"),$("#recount").linkbutton(n)}}).on("success",function(e,t){if(t.res._next){!async function(e){await function(e){return new Promise(t=>{dwap.page.saverows(e,t)})}(e);const t=await function(e){return new Promise(t=>{var i={_func:"get",_sqlid:"inv^physical_count_lines",_dgrid:"y",PHYSICAL_COUNT_ID:e};dwap.page.lines(i,t)})}(e);cb(t)}(t.res._next)}"del"==t.mode&&$("#lines").datagrid("loadData",{total:0,rows:[]})}),$("#TRACEABLE,#DIM_TRACKED,#PART_CLASS_ID,#CYCLE_COUNT,#PRODUCT_CODE").combobox({onSelect:function(){dwap.page.qbe()}}),$("#PART_ID").textbox({onChange:function(){dwap.page.qbe()}}),$("#endcount").linkbutton({onClick:function(){var e=$("#PHYSICAL_COUNT_ID").combobox("getValue"),t=$("#pwd").textbox("getValue");$("#END_DATE").datebox("clear"),ajaxget("/",{_sqlid:"user^passwd",_func:"get",pwd:t,_uid:dwap.udata.userid},function(t){t.error||confirm(function(t){t&&($("#END_DATE").datebox("setValue",new Date),$("#END_COUNT_USER").textbox("setValue",dwap.udata.userid),ajaxget("/",{_sqlid:"inv^physical_count",_func:"upd",PHYSICAL_COUNT_ID:e,END_DATE:new Date,END_COUNT_USER:dwap.udata.userid},function(e){$("#endcount").linkbutton("disable"),$("#pwd").textbox("clear"),$("#PHYSICAL_COUNT_ID").combobox("reload")}))},"End Count :"+e+" ?")})}}),$("#_dgform").dialog({buttons:[{id:"prev",iconCls:"pagination-prev",handler:function(){var e=$("#lines"),t=e.datagrid("getSelected");if(t){if(t.PHYSICAL_COUNT_ID){var i=e.datagrid("getRowIndex",t),n={PHYSICAL_COUNT_ID:t.PHYSICAL_COUNT_ID,LINE_NO:t.LINE_NO,_func:"upd",_sqlid:"inv^physical_count_line"};n.COUNT=$("#_dgform > form input[textboxname=COUNT").numberspinner("getValue"),n.RECOUNT=$("#_dgform > form input[textboxname=RECOUNT").numberspinner("getValue"),n.NOTES=$("#_dgform > form input[textboxname=NOTES").textbox("getValue"),ajaxget("/",n,function(t){e.datagrid("updateRow",{index:i,row:n})});var o=e.datagrid("options").pageSize,a=e.datagrid("options").pageNumber;if(0==i)e.datagrid("gotoPage",parseInt(a)-1),setTimeout(function(){e.datagrid("selectRow",parseInt(o)-1);var t=e.datagrid("getSelected");$("#_dgform").form("load",t)},500);else{i<0?e.datagrid("selectRow",0):e.datagrid("selectRow",parseInt(i)-1);var d=e.datagrid("getSelected");$("#_dgform").form("load",d)}}}else $("#_dgform > form").form("clear")}},{id:"next",iconCls:"pagination-next",handler:function(){var e=$("#lines"),t=e.datagrid("getSelected");if(t){if(t.PHYSICAL_COUNT_ID){var i=e.datagrid("getRowIndex",t),n={PHYSICAL_COUNT_ID:t.PHYSICAL_COUNT_ID,LINE_NO:t.LINE_NO,_func:"upd",_sqlid:"inv^physical_count_line"};n.COUNT=$("#_dgform > form input[textboxname=COUNT").numberspinner("getValue"),n.RECOUNT=$("#_dgform > form input[textboxname=RECOUNT").numberspinner("getValue"),n.NOTES=$("#_dgform > form input[textboxname=NOTES").textbox("getValue"),ajaxget("/",n,function(t){e.datagrid("updateRow",{index:i,row:n})});var o=e.datagrid("options").pageSize,a=e.datagrid("options").pageNumber;if(o==parseInt(i)+1)e.datagrid("gotoPage",parseInt(a)+1),setTimeout(function(){e.datagrid("selectRow",0);var t=e.datagrid("getSelected");$("#_dgform").form("load",t)},500);else{e.datagrid("selectRow",parseInt(i)+1);var d=e.datagrid("getSelected");$("#_dgform").form("load",d)}}}else $("#_dgform > form").form("clear")}},{text:"Save",iconCls:"icon-save",handler:function(){var e=$("#_dgform > form");if(e.form("validate")){var t=e.form("getData");t._sqlid="inv^physical_count_line",ajaxget("/",t,function(){$("#_dgform").dialog("close"),$("#lines").datagrid("reload")})}}},{text:"Cancel",iconCls:"icon-cancel",handler:function(){$("#_dgform").dialog("close")}}]})});