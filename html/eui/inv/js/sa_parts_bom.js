const cl=console.log;dynjs("/js/xlsx.core.js"),$("#bomval").linkbutton({size:"small",onClick:function(){var t=$("#boms");ajaxget("/",{_sqlid:"inv^partbom_vali",_func:"put",PART_ID:$("#ID").textbox("getValue")},function(e){t.datagrid("reload");var a=t.datagrid("getRows");$.each(a,function(e,a){"Y"==a.EXIST?ajaxget("/",{_func:"get",_sqlid:"inv^partall",ID:a.ITEM_ID},o=>{""==o.BAL_QTY?a.QOH=0:a.QOH=o.BAL_QTY,t.datagrid("updateRow",{index:e,row:a})}):a.QOH="-"}),msgbox(e.msg)})}}),$("#qoh").linkbutton({size:"small",onClick:function(){var t=$("#boms"),e=t.datagrid("getRows");$.each(e,function(e,a){"Y"==a.EXIST?ajaxget("/",{_func:"get",_sqlid:"inv^partall",ID:a.ITEM_ID},o=>{""==o.BAL_QTY?a.QOH=0:a.QOH=o.BAL_QTY,t.datagrid("updateRow",{index:e,row:a})}):a.QOH="-"})}}),$("#xlbom").filebox({multiple:!1,buttonText:"Select",buttonAlign:"right",buttonIcon:"icon-xls",onChange:function(t,e){$(this).textbox("textbox")[0].value=t.replace("C:\\fakepath\\","");var a=$(this).data("filebox").filebox.children("input[type=file]")[0].files[0],o=a.name;if(/\.xls|\.xlsx/.test(o)){var i=new FileReader;i.onload=dwap.page.xlbom,i.readAsArrayBuffer(a)}else msgbox("Excel Files Only.")}}),dwap.page.xlbom=function(t){function e(t,e){const a={E:"NO",G:"ID",M:"REV",N:"DESC",AD:"QTY",AE:"UOM"};var o=!1;do{var l={};for(var r in a){var s=t[`${r}${e}`];if(s&&s.v){if(s.v==i){o=!0;break}l[a[r]]=s.v}}l.ID&&n.items.push(l),e++}while(!o);!function(){try{$("#xlbom").filebox("clear")}catch(t){}}();var c=$("#ID").textbox("getValue");if(!n.ID||c!=n.ID)return msgbox("Selected file is not for this part.");ajaxget("/",Object.assign(n,{_sqlid:"inv^partbom",_func:"put"}),function(t){$("#boms").datagrid("reload"),t.error?msgbox(t.msg):msgbox(`${n.ID} uploaded ${n.items.length} items.`)})}const a=200,o="List Of Items",i="END";var n={items:[]},l=XLSX.read(t.target.result,{type:"binary"}),r=l.SheetNames[0],s=l.Sheets[r];!function(){var t={M3:"ID",X3:"REV",AC3:"REV_DATE",A9:"DESCRIPTION"};for(var e in t){var a=s[e];a&&(n[t[e]]=a.v)}}(),function(){for(var t=1;t<a;){var i=s[`A${t}`];if(++t>a||i&&i.v==o)return e(s,t+1)}}()};