dwap.page.traceable=function(){var e=dwap.bhave.partTraceManual||"y";$("#TRACEABLE").combobox("setValue",e.toUpperCase())},dwap.page.material_unit_cost=function(){var e=$("#TRACEABLE").combobox("getValue"),t=dwap.bhave.MANDATORY_UNITCOST,a=!1;"N"==e&&"Y"==t.toUpperCase()&&(a=!0);var i=$("#UNIT_MATERIAL_COST");i.numberbox("required",a),i.numberbox("enable")},dwap.page.costitems=function(){var e=dwap.page.fdat(),t=$("#UNIT_CONSUMABLE_COST"),a=$("#UNIT_MATERIAL_COST"),i=!1;e.BAL_QTY>0&&(i=!0),a.numberspinner("readonly",i),t.numberspinner("readonly",i),"CONSUMABLE"==e.PART_CLASS_ID?(a.parent().hide(),t.parent().show(),a.numberspinner("setValue",0)):(a.parent().show(),t.parent().hide(),t.numberspinner("setValue",0))},dwap.page.nocarat=function(e){return e.replace(/\^/g,"-")},dwap.page.fdat=function(e){var t=frm2dic($("#partf"));return e?t[e]:t},dwap.page.dims=function(e){var t=$("#DIM_TRACKED"),a=$("#LENGTH").combobox("getValue"),i=$("#WIDTH").combobox("getValue"),d=$("#HEIGHT").combobox("getValue");"Y"!=a&&"Y"!=i&&"Y"!=d||t.combobox("setValue","Y"),"N"==a&&"N"==i&&"N"==d&&t.combobox("setValue","N")},dwap.page.prices=function(){ajaxget("/",{_sqlid:"admin^curr",_func:"get"},function(e){dwap.page.currs=e});var e=$("#prices");e.datagrid().datagrid("rowEditor",{editor:"inline",striped:!0,rownumbers:!1,_fitColumns:!0,fit:!0,columns:[[{field:"PART_ID",hidden:!0,title:""},{field:"CURRENCY_ID",title:"Cur ID",width:60},{field:"DESCRIPTION",title:"Description",width:120},{field:"UNIT_PRICE",title:"Price",width:60,align:"right",editor:{type:"numberbox",options:{precision:2,min:0}},formatter:eui.currency}]],onEndEdit:function(e,t,a){var i=$.extend(t,{_sqlid:"inv^part_price",_func:"upd"});ajaxget("/",i,function(e){cl(e)})}});var t=e.datagrid("options");t.tbar.dgre_del.hide(),t.tbar.dgre_edit.hide(),t.tbar.dgre_add.hide()},dwap.page.opengen=function(){$("#pngenwin").window({title:"Part Number Generator",closed:!0,minimizable:!1,draggable:!0,modal:!0,onBeforeClose:function(){if(!$("#ID").textbox("getValue"))return alert("Please generate the part."),!1}}),$("#but_add").on("done",function(e){if(dwap.page.costitems(),$("#phycount").datagrid("loadData",[]),!dwap.page.dogen)return dwap.page.traceable(),dwap.page.material_unit_cost(),!1;$("#pngenwin").window("move",{left:362,top:78}),$("#pngenwin").window("open"),dwap.page.traceable(),dwap.page.material_unit_cost()})},dwap.page.partgen=function(){"y"==dwap.bhave.partgen?($("#addmenu").menu({onClick:function(e){"gen"==e.name?dwap.page.dogen=!0:dwap.page.dogen=!1,but_add()},onShow:function(){$(this),$(this)}}),dwap.page.opengen()):$("#but_add").on("done",function(e){dwap.page.costitems(),$("#phycount").datagrid("loadData",[]),$("#boms").datagrid("loadData",[])})},dwap.page.part_ud=(()=>{var e=dwap.udata.groups.indexOf("PART-UD");$("#but_add").on("done",function(t){dwap.page.costitems(),$("#phycount").datagrid("loadData",[]),$("#boms").datagrid("loadData",[]),-1==e&&"y"==dwap.bhave.partgen&&($("#pngenwin").window("move",{left:362,top:78}),$("#pngenwin").window("open"))}),setTimeout(()=>{-1==e&&"n"==dwap.bhave.partgen&&$("#but_add").linkbutton("disable")})}),dwap.page.mandatory=(()=>{var e=!0;"n"==(dwap.bhave.MANDATORY_REVISION||"n")&&(e=!1),$("#PART_REV_NO").textbox("required",e)}),dwap.page.part_detail_upd=(()=>{var e=dwap.udata.groups.indexOf("PART-DETAIL-UPD"),t=!1;-1==e&&(t=!0),$("#header :input").attr("disabled",t),-1==e?$("#but_save").linkbutton("disable"):$("#but_save").linkbutton("enable")}),dwap.page.ecn=(e=>{var t=$("#ECN_ID");t.textbox("required",e),t.textbox("readonly",!e),1==e&&t.textbox("clear")}),$(document).ready(function(){dwap.page.partgen(),dwap.page.prices(),$("form#partquery").removeAttr("asdpx"),$("#UDF_LAYOUT_ID").combobox({onSelect:setudfs}),$("#PART_CLASS_ID").combobox({onSelect:function(e){dwap.page.costitems()}}),$("#LENGTH").combobox({onSelect:function(e){dwap.page.dims("l")}}),$("#WIDTH").combobox({onSelect:function(e){dwap.page.dims("w")}}),$("#HEIGHT").combobox({onSelect:function(e){dwap.page.dims("h")}}),$("#TRACEABLE").combobox({onSelect:function(e){dwap.page.material_unit_cost()},onChange:function(e,t){dwap.page.material_unit_cost()}}),$("#UNIT_MATERIAL_COST").numberbox({onChange:function(e,t){}}),$("#partf").on("changed",function(e,t){}).on("loadDone",function(e,t){$("#_PART_REV_NO").val(t.PART_REV_NO),dwap.page.ecn(!1),dwap.page.costitems(),dwap.page.fkey=t.ID,$("#partfiles").datagrid("docFiles",dwap.page.fkey);var a=$("#UDF_LAYOUT_ID").combobox("getRec");setudfs(a,$(this)),setTimeout(function(){"y"==dwap.bhave.partgen?-1==dwap.udata.groups.indexOf("PART-UD")?butEn("asdx"):butEn("nsdx"):butEn("asdx"),$("form#partquery input#QRY_PART_ID").combobox("select",t.ID).combobox("readonly",!0);var e=[];dwap.page.currs.map(function(a){e.push({PART_ID:t.ID,CURRENCY_ID:a.id,DESCRIPTION:a.description,UNIT_PRICE:t.PRICE[a.id]||0})}),$("#prices").datagrid("loadData",e),$("#dgdim").datagrid("load"),$("#usedin_src").combobox("clear"),$("#usedin").datagrid("loadData",[]),$("#phycount").datagrid("load",{_func:"get",_dgrid:"y",_sqlid:"inv^physical_count_lines_by_part",PART_ID:t.ID}),$("#boms").datagrid("load",{_func:"get",_dgrid:"y",_sqlid:"inv^partbom",PART_ID:t.ID}),dwap.page.part_ud(),$("#PART_REV_NO").textbox({onChange:(e,t)=>{e!=$("#_PART_REV_NO").val()?dwap.page.ecn(!0):dwap.page.ecn(!1)}}),dwap.page.part_detail_upd(),dwap.page.material_unit_cost(),dwap.page.mandatory()})}),$("#ID").qbe({defid:"part",preload:!0}),$("#usedin_src").combobox({panelHeight:"auto",groupField:"appid",data:[{value:"JOBS",text:"Job Header",appid:"Manufacturing",columns:[[{field:"WO_CLASS",title:"Job Class"},{field:"BASE_ID",title:"Job Number"},{field:"STATUS",title:"Status"},{field:"DESIRED_QTY",title:"Run Qty"},{field:"DESIRED_WANT_DATE",title:"Want Date",formatter:eui.date},{field:"WO_TYPE",title:"Job Class"}]]},{value:"OPN",text:"Job Operations",appid:"Manufacturing",columns:[[{field:"WO_JOB_ID",title:"Job Number"},{field:"SEQ_NO",title:"Seq No"},{field:"STATUS",title:"Status"},{field:"REQUIRED_QTY",title:"Reqd Qty"},{field:"WANT_DATE",title:"Want Date",formatter:eui.date}]]},{value:"SO",text:"Sales Order Lines",appid:"Sales",columns:[[{field:"SALES_ORDER_ID",title:"SO ID"},{field:"LINE_NO",title:"Line #"},{field:"DATE",title:"Order Date",formatter:eui.date},{field:"STATUS",title:"Status"},{field:"CUST_ID",title:"Customer ID"},{field:"CUST_NAME",title:"Customer Name"},{field:"QTY",title:"Order Qty"},{field:"QTY_SHIP",title:"Ship Qty"}]]},{value:"SHP",text:"Shipment Lines",appid:"Sales",columns:[[{field:"SHIPMENT_ID",title:"Shipment ID"},{field:"SHIPMENT_DATE",title:"Shipped Date",formatter:eui.date},{field:"LINE_NO",title:"Line #"},{field:"INVOICE_ID",title:"Invoice ID"},{field:"SO_ID",title:"Sales Order ID"},{field:"SO_LINENO",title:"SO Line No"},{field:"QTY",title:"Shipped Qty"}]]},{value:"COC",text:"COC Source",appid:"Quality",columns:[[{field:"COC_ID",title:"COC ID"},{field:"COC_REV",title:"Revn No"},{field:"STATUS",title:"Status"},{field:"CREATE_DATE",title:"COC Date",formatter:eui.date},{field:"PRINTED_DATE",title:"Print Date",formatter:eui.date},{field:"WOREF",title:"Job Number",formatter:dwap.page.nocarat},{field:"CUSTOMER_ID",title:"Cust ID"},{field:"QTY",title:"Qty"},{field:"ISSUED_BY",title:"Creator"}]]},{value:"CPAR",text:"CPAR Source",appid:"Quality",columns:[[{field:"NCR_ID",title:"NCR ID"},{field:"CREATE_DATE",title:"Date",formatter:eui.date},{field:"STATUS",title:"Status"},{field:"WOREF",title:"Linked Job",formatter:dwap.page.nocarat},{field:"SUBJECT",title:"Subject"},{field:"SEVERITY",title:"Severity"}]]},{value:"NCR",text:"NCR Source",appid:"Quality",columns:[[{field:"NCR_ID",title:"NCR ID"},{field:"CREATE_DATE",title:"Date",formatter:eui.date},{field:"STATUS",title:"Status"},{field:"WOREF",title:"Linked Job",formatter:dwap.page.nocarat},{field:"SUBJECT",title:"Subject"},{field:"SEVERITY",title:"Severity"}]]}],onSelect:function(e){$("#usedin").datagrid({type:e.value,columns:e.columns}).datagrid("reload")}}),$("#usedin").datagrid({url:"/",type:null,queryParams:{_func:"get",_dgrid:!0,_sqlid:"inv^part_used",PART_ID:null,type:null},fit:!0,fitColumns:!0,striped:!0,singleSelect:!0,columns:[[]],onBeforeLoad:function(e){var t=$(this).datagrid("options");if(e.PART_ID=$("#ID").qbe("getValue"),e.type=t.type,!e.PART_ID)return!1}}),$("#phycount").datagrid({url:"/",type:null,queryParams:{_func:"get",_dgrid:!0,_sqlid:"inv^physical_count_lines_by_part",PART_ID:null},fit:!0,striped:!0,singleSelect:!0,columns:[[{field:"PHYSICAL_COUNT_ID",title:"Physical Count ID",width:150},{field:"STATUS",title:"Status",width:120},{field:"START_DATE",title:"Start Date",formatter:eui.date,width:120},{field:"END_DATE",title:"End Date",formatter:eui.date,width:120},{field:"NOTES",title:"Notes",width:120}]],onBeforeLoad:function(e){if(e.PART_ID=$("#ID").qbe("getValue"),!e.PART_ID)return!1}}),$("#boms").datagrid({url:"/",type:null,queryParams:{_func:"get",_dgrid:!0,_sqlid:"inv^partbom",PART_ID:null},fit:!0,striped:!0,singleSelect:!0,fitColumns:!0,columns:[[{field:"PART_ID",hidden:!0,title:""},{field:"LINE_NO",title:"Line #"},{field:"_EXIST",title:"Exists",styler:function(e,t,a){if("Y"==t.EXIST)var i="icon-tick";else i="icon-cross";return{class:i,style:"background-position:center center;background-repeat:no-repeat;"}}},{field:"ITEM_ID",title:"Item ID"},{field:"QTY",title:"Qty"},{field:"REV",title:"Rev"},{field:"UOM_ID",title:"UOM"},{field:"QOH",title:"QOH"},{field:"DESCRIPTION",title:"Description"}]],onBeforeLoad:function(e){if(e.PART_ID=$("#ID").qbe("getValue"),!e.PART_ID)return!1},onBeforeSelect:function(e,t){return!1}}),dwap.page.part_ud(),setTimeout(()=>{dwap.page.mandatory(),dwap.page.part_detail_upd()})});