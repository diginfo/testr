dwap.page.dgrid=function(t){var e=$("#tracedg"),a=(t=t||{trace:[],part:[{}]}).trace,o=0;a.map(function(t){o+=t.QTY,t.RUNNING_TOTAL=o}),t.trace=a,e.datagrid({editor:"inline",rownumbers:!0,singleSelect:!0,striped:!1,fit:!0,fitColumns:!0,loadFilter:function(t){if(t.trace.length>0)var e="disable";else e="enable";try{"enable"==e?$("#TRACEABLE").combobox("readonly",!1):$("#TRACEABLE").combobox("readonly",!0),$("#LENGTH").combobox(e),$("#WIDTH").combobox(e),$("#HEIGHT").combobox(e)}catch(t){}return{rows:t.trace,total:t.trace.length}},columns:function(e){function a(t){return t?t.toFixed(4):"0.0000"}var o=[{field:"TRANSACTION_DATE",title:"Date",width:80,fixed:!0,formatter:tz2date},{field:"TRANS_TYPE",title:"Type",width:70,fixed:!0},{field:"TRACE_ID",title:"Trace ID",width:150,fixed:!0,styler:function(){return{class:"click"}}},{field:"QTY",title:"Txn Qty",width:60,fixed:!0,align:"right",formatter:a},{field:"TRANS_UNIT_MATERIAL_COST",title:"Unit $",width:60,fixed:!0,align:"right",formatter:a},{field:"RUNNING_TOTAL",title:"Bal Qty",width:60,fixed:!0,align:"right",formatter:a},{field:"WOREF",title:"Job Ref",width:120,fixed:!0,formatter:function(t){return woref2text(t)},styler:function(){return{class:"click"}}},{field:"DOCUMENT_ID",title:"Document ID",width:100,fixed:!1}];for(i=1;i<11;i++)if("N"==t.part[0].TRACEABLE)(r=t.part[0]["UDF_"+i]||null)&&o.push({field:"USER_"+i,title:r.replace("*",""),width:100});else{var r=t.part[0]["TRACE_USER_"+i+"_LBL"]||null;r&&o.push({field:"TRACE_USER_"+i,title:r.replace("*",""),width:100})}return[o]}(),data:t,onRowContextMenu:function(t){t.preventDefault()},_rowStyler:function(t,e){var a=$(this).datagrid("getRows")[t+1];if(!a||a.TRACE_ID!=e.TRACE_ID)return{class:"last bg-ora"}},onSelect:function(){$(this).datagrid("unselectAll")},onDblClickCell:function(t,e,a){var i=$("#"+e);i.length&&setTimeout(function(){i.combobox("select",a)},100)}})},dwap.page.getdata=function(){var t=$(this),e=t.attr("id"),a=formdata("form#partquery",{_sqlid:"inv^trace_trans",_func:"get"});ajaxget("/",a,function(a){if(dwap.page.dgrid(a),"QRY_PART_ID"==e){var i=[{value:"",text:"SHOW ALL",selected:!0}],o=[],r=[{value:"",text:"SHOW ALL",selected:!0}],l=[],n=t.combobox("getRec"),d=$("form#partquery #WOREF"),c=$("form#partquery #BALQTY"),f=$("form#partquery #TRACE_ID"),u=$("form#partquery input.easyui-datebox");a.trace.map(function(t){-1==l.indexOf(t.TRACE_ID)&&(l.push(t.TRACE_ID),r.push({value:t.TRACE_ID,text:t.TRACE_ID})),t.WOREF&&-1==o.indexOf(t.WOREF)&&(o.push(t.WOREF),i.push({BASE_ID:t.WOREF.split("^")[0],value:t.WOREF,text:woref2text(t.WOREF)}))}),d.combobox("enable").combobox("loadData",keysort(i,"value"));var s="Qty "+n.BAL_QTY;"Y"==n.TRACEABLE&&(s+=" ( in "+l.length+" traces )"),c.textbox("setValue",s),f.combobox("loadData",keysort(r,"value")),"Y"==n.TRACEABLE?f.combobox("enable"):f.combobox("disable"),u.datebox("enable")}})},$("form#partquery input.easyui-combobox").combobox({onSelect:dwap.page.getdata}),$("form#partquery input.easyui-datebox").datebox({disabled:!0,onChange:dwap.page.getdata,icons:[{iconCls:"icon-clear",handler:function(t){$(t.data.target).datebox("clear"),dwap.page.getdata()}}]}),dwap.page.dgrid();