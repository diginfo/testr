dwap.page.opts={editor:"form",addData:{LINE_NO:"$autonum:1",WIP_COUNT_ID:"#WIP_COUNT_ID"},striped:!0,url:"/",queryParams:{_sqlid:"inv^wip_count_jobs",_func:"get",_dgrid:"y"},rownumbers:!1,_fitColumns:!0,fit:!0,pagePosition:"bottom",pagination:!0,pageList:[25,50,100,250],pageSize:25,columns:[[{field:"WIP_COUNT_ID",hidden:!0},{field:"LINE_NO",title:"#",width:30,fixed:!0,align:"center"},{field:"WOREF",title:"Opn Ref",width:150,fixed:!0,align:"left",editor:{type:"qbe",options:{required:!0,queryParams:{_sqlid:"inv^wip_count_jobs",_qbe:"y"},onDemand:!0,multiCol:!0,valueField:"WOREF",fields:[{field:"text",title:"Opn Ref",editor:"textbox"},{field:"WO_CLASS",title:"Job Class"},{field:"PART_ID",title:"Part ID",editor:"textbox"},{field:"TRACE_ID",title:"Trace ID"},{field:"CP_REF",title:"CP Ref"}],onSelect:function(t){$("#_dgform > form input[textboxname=WOREF").textbox("setValue",t.text),$("#_dgform > form input[textboxname=CP_REF").textbox("setValue",t.CP_REF)}}}},{field:"PART_ID",title:"Our Part ID",width:150,editor:{type:"qbe",options:{required:!0,queryParams:{_sqlid:"inv^partid_qbe"},onDemand:!0,multiCol:!0,valueField:"ID",fields:[{field:"value",title:"Part ID",editor:"textbox"},{field:"DESCRIPTION",title:"Description",editor:"textbox",formatter:function(t){return t?t.substring(0,50):""}},{field:"ALIAS_DESC",title:"Alias",editor:"textbox"},{field:"TRACEABLE",title:"Traceable",editor:{type:"combobox",options:{panelHeight:"auto",data:[{value:"",text:"All",selected:!0},{value:"Y",text:"Yes"},{value:"N",text:"No"}]}}},{field:"DIM_TRACKED",title:"Dimensions",editor:{type:"combobox",options:{panelHeight:"auto",data:[{value:"",text:"All",selected:!0},{value:"Y",text:"Yes"},{value:"N",text:"No"}]}}},{field:"PART_CLASS_ID",title:"Part Class",editor:{type:"combobox",options:{panelHeight:"auto",data:[{value:"",text:"All",selected:!0},{value:"FG",text:"Finished Goods"},{value:"COMP",text:"Component"},{value:"CONSUMABLE",text:"Consumable"},{value:"MAKE_STAGED",text:"Make Staged"},{value:"MAKE_NOSTAGE",text:"Make Unstaged"}]}}}],onSelect:function(t){if("Y"==t.TRACEABLE)var e=!0;else e=!1;var o=$("#_dgform > form input[textboxname=TRACE_ID");o.textbox("required",e),o.textbox("readonly",!e),$("#_dgform > form input[textboxname=DESCRIPTION").textbox("setValue",t.DESCRIPTION)}}}},{field:"CP_REF",title:"CP REF",width:100,fixed:!0,editor:{type:"textbox",options:{readonly:!1}}},{field:"DESCRIPTION",title:"Description",width:100,fixed:!0,editor:{type:"textbox",options:{readonly:!1}}},{field:"TRACE_ID",title:"Trace ID",width:100,fixed:!0,align:"left",editor:{type:"textbox",options:{readonly:!0}}},{field:"COUNT",title:"Count Qty",width:100,fixed:!0,align:"left",editor:{type:"numberspinner",options:{precision:2,min:0,value:0,id:"count",readonly:!1}}},{field:"RECOUNT",title:"RECount Qty",width:100,fixed:!0,align:"left",editor:{type:"numberspinner",options:{precision:2,min:0,value:0,id:"recount",readonly:!1}}},{field:"NOTES",title:"Notes",width:250,fixed:!0,editor:{type:"textbox",options:{readonly:!1,multiline:!0,height:150}}}]],onRowContextMenu:function(t){return t.preventDefault()},onBeforeLoad:function(t){var e=!0;return t.WIP_COUNT_ID||t.WO_CLASS||(e=!1),e},loadFilter:function(t){return t&&(t.rows||0!=t.length)||(t={rows:[],total:0}),t},onEndEdit:function(t,e,o){var i=clone(e);void 0==i.WIP_COUNT_ID||ajaxget("/?_sqlid=inv^wip_count_line",i,function(t){})},onSelect:function(t,e){e&&(void 0==e.WIP_COUNT_ID&&$(this).datagrid("options").tbar.dgre_edit.linkbutton("disable"),""!=$("#END_COUNT_USER").textbox("getValue")&&($(this).datagrid("options").tbar.dgre_add.linkbutton("disable"),$(this).datagrid("options").tbar.dgre_edit.linkbutton("disable"),$(this).datagrid("options").tbar.dgre_del.linkbutton("disable")),dwap.page.count())}},dwap.page.jobs=function(t){var e=$("#WIP_COUNT_ID").combobox("getValue"),o=$("#lines");if(e.length<=0){var i={_func:"get",_sqlid:"inv^wip_count_jobs",WO_CLASS:$("#WO_CLASS").combobox("getValue")};o.datagrid("options").queryParams._sqlid="inv^wip_count_jobs",delete o.datagrid("options").queryParams.WIP_COUNT_ID}else i={_func:"get",_sqlid:"inv^wip_count_lines",WIP_COUNT_ID:e},o.datagrid("options").queryParams._sqlid="inv^wip_count_lines",delete o.datagrid("options").queryParams.WO_CLASS;$("#lines").datagrid("load",i)},dwap.page.saverows=function(t,e){ajaxget("/",{_sqlid:"inv^wip_count_lines",_func:"add",WO_CLASS:e,wip_count_id:t},function(e){$("#WIP_COUNT_ID").combobox("setValue",t)})},dwap.page.count=function(){var t=!1;t=!($("#lines").datagrid("getSelected").COUNT>0),$("#_dgform > form input[textboxname=COUNT").numberspinner("readonly",!t),$("#_dgform > form input[textboxname=RECOUNT").numberspinner("readonly",t)},dwap.page.endis=function(t){$("#but_save").linkbutton(t),$("#but_del").linkbutton(t),$("#endcount").linkbutton(t),$("#WO_CLASS").combobox(t),$("#START_DATE").datebox(t),$("#END_DATE").datebox(t),$("#pwd").textbox(t),$("#NOTES").textbox(t),$("#lines").datagrid("options").tbar.dgre_add.linkbutton(t),$("#lines").datagrid("options").tbar.dgre_edit.linkbutton(t),$("#lines").datagrid("options").tbar.dgre_del.linkbutton(t)},$(document).ready(function(){$("#lines").datagrid("rowEditor",dwap.page.opts),$("#but_add").on("done",function(){$("#WO_CLASS").combobox("reload"),$("#WO_CLASS").combobox("enable"),$("#START_DATE").datebox("enable"),$("#END_DATE").datebox("disable"),$("#lines").datagrid("options").tbar.dgre_add.linkbutton("disable"),$("#lines").datagrid("options").tbar.dgre_edit.linkbutton("disable"),$("#lines").datagrid("options").tbar.dgre_del.linkbutton("disable"),$("#lines").datagrid("loadData",{total:0,rows:[]}),$("#endcount").linkbutton("disable"),butEn("sdx")}),$("form#wip_count").on("loadDone",function(t,e){dwap.page.jobs();var o="enable";e.END_COUNT_USER.length>0&&(o="disable"),dwap.page.endis(o)}).on("success",function(t,e){if(e.res._next){var o=$("#WO_CLASS").combobox("getValue");dwap.page.saverows(e.res._next,o),dwap.page.jobs();var i="enable";$("#END_COUNT_USER").textbox("getValue").length>0&&(i="disable"),dwap.page.endis(i)}"del"==e.mode&&setTimeout(function(){$("#lines").datagrid("loadData",{total:0,rows:[]})},500)}),$("#WO_CLASS").combobox({onSelect:function(t){dwap.page.jobs()}}),$("#endcount").linkbutton({onClick:function(){var t=$("#WIP_COUNT_ID").combobox("getValue"),e=$("#pwd").textbox("getValue");ajaxget("/",{_sqlid:"user^passwd",_func:"get",pwd:e,_uid:dwap.udata.userid},function(e){e.error||confirm(function(e){e&&($("#END_DATE").datebox("setValue",new Date),$("#END_COUNT_USER").textbox("setValue",dwap.udata.userid),ajaxget("/",{_sqlid:"inv^wip_count",_func:"upd",WIP_COUNT_ID:t,END_DATE:new Date,END_COUNT_USER:dwap.udata.userid},function(t){$("#endcount").linkbutton("disable"),$("#pwd").textbox("clear")}))},"End Count :"+t+" ?")})}}),$("#_dgform").dialog({buttons:[{id:"prev",iconCls:"pagination-prev",handler:function(){var t=$("#lines"),e=t.datagrid("getSelected"),o=t.datagrid("getRowIndex",e),i={WIP_COUNT_ID:e.WIP_COUNT_ID,LINE_NO:e.LINE_NO,_func:"upd",_sqlid:"inv^wip_count_line"};i.COUNT=$("#_dgform > form input[textboxname=COUNT").numberspinner("getValue"),i.RECOUNT=$("#_dgform > form input[textboxname=RECOUNT").numberspinner("getValue"),i.CP_REF=$("#_dgform > form input[textboxname=CP_REF").textbox("getValue"),i.DESCRIPTION=$("#_dgform > form input[textboxname=DESCRIPTION").textbox("getValue"),i.NOTES=$("#_dgform > form input[textboxname=NOTES").textbox("getValue"),ajaxget("/",i,function(e){t.datagrid("updateRow",{index:o,row:i})});var n=t.datagrid("options").pageSize,a=t.datagrid("options").pageNumber;if(0==o)t.datagrid("gotoPage",parseInt(a)-1),setTimeout(function(){t.datagrid("selectRow",parseInt(n)-1);var e=t.datagrid("getSelected");$("#_dgform").form("load",e),$("#_dgform > form input[textboxname=COUNT").numberspinner().focus()},500);else{o<0?t.datagrid("selectRow",0):t.datagrid("selectRow",parseInt(o)-1);var d=t.datagrid("getSelected");$("#_dgform").form("load",d)}}},{id:"next",iconCls:"pagination-next",handler:function(){var t=$("#lines"),e=t.datagrid("getSelected"),o=t.datagrid("getRowIndex",e),i={WIP_COUNT_ID:e.WIP_COUNT_ID,LINE_NO:e.LINE_NO,_func:"upd",_sqlid:"inv^wip_count_line"};i.COUNT=$("#_dgform > form input[textboxname=COUNT").numberspinner("getValue"),i.RECOUNT=$("#_dgform > form input[textboxname=RECOUNT").numberspinner("getValue"),i.CP_REF=$("#_dgform > form input[textboxname=CP_REF").textbox("getValue"),i.DESCRIPTION=$("#_dgform > form input[textboxname=DESCRIPTION").textbox("getValue"),i.NOTES=$("#_dgform > form input[textboxname=NOTES").textbox("getValue"),ajaxget("/",i,function(e){t.datagrid("updateRow",{index:o,row:i})});var n=t.datagrid("options").pageSize,a=t.datagrid("options").pageNumber;if(n==parseInt(o)+1)t.datagrid("gotoPage",parseInt(a)+1),setTimeout(function(){t.datagrid("selectRow",0);var e=t.datagrid("getSelected");$("#_dgform").form("load",e)},500);else{t.datagrid("selectRow",parseInt(o)+1);var d=t.datagrid("getSelected");$("#_dgform").form("load",d)}}},{text:"Save",iconCls:"icon-save",handler:function(){var t=$("#_dgform > form");if(t.form("validate")){var e=t.form("getData");e._sqlid="inv^wip_count_line",ajaxget("/",e,function(){$("#_dgform").dialog("close"),$("#lines").datagrid("reload")})}}},{text:"Cancel",iconCls:"icon-cancel",handler:function(){$("#_dgform").dialog("close")}}]})});